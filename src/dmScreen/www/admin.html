<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DM Screen Admin</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div id="backdrop" class="backdrop">
        <div class="backdrop-content">
            <div class="spinner_black"></div>
            <p id="backdrop-text"></p>
        </div>
    </div>
    
    <!-- Alert Modal Dialog -->
    <div id="alert-modal" class="backdrop">
        <div class="backdrop-content modal-dialog">
            <div class="modal-header">
                <h3 id="alert-title">Information</h3>
            </div>
            <div class="modal-body">
                <p id="alert-message"></p>
            </div>
            <div class="modal-footer">
                <button id="alert-ok-btn" class="btn">OK</button>
            </div>
        </div>
    </div>
    
    <!-- Confirm Modal Dialog -->
    <div id="confirm-modal" class="backdrop">
        <div class="backdrop-content modal-dialog">
            <div class="modal-header">
                <h3 id="confirm-title">Confirmation</h3>
            </div>
            <div class="modal-body">
                <p id="confirm-message"></p>
            </div>
            <div class="modal-footer">
                <button id="confirm-cancel-btn" class="btn">Cancel</button>
                <button id="confirm-ok-btn" class="btn">OK</button>
            </div>
        </div>
    </div>
    
    <!-- Crop Modal Dialog -->
    <div id="crop-modal" class="backdrop">
        <div class="backdrop-content modal-dialog crop-dialog">
            <div class="modal-header">
                <h3>Crop and Transform Image</h3>
            </div>
            <div class="modal-body user-select-none">
                <div class="crop-container">
                    <div id="crop-preview-container">
                        <div id="crop-loading-spinner" class="crop-loading-overlay">
                            <div class="spinner_black"></div>
                        </div>
                        <canvas id="crop-preview-canvas" width="800" height="450"></canvas>
                        <div id="crop-selection" class="crop-selection">
                            <div class="resize-handle top-left"></div>
                            <div class="resize-handle top-right"></div>
                            <div class="resize-handle bottom-left"></div>
                            <div class="resize-handle bottom-right"></div>
                        </div>
                    </div>
                    <div class="crop-controls">
                        <div class="form-group">
                            <label>Mirror Options:</label>
                            <div class="mirror-controls">
                                <label>
                                    <input type="checkbox" id="mirror-h"> Horizontal
                                </label>
                                <label>
                                    <input type="checkbox" id="mirror-v"> Vertical
                                </label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Rotation:</label>
                            <div class="rotation-controls">
                                <button id="rotate-0" class="btn">0째</button>
                                <button id="rotate-90" class="btn">90째</button>
                                <button id="rotate-180" class="btn">180째</button>
                                <button id="rotate-270" class="btn">270째</button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Crop Options:</label>
                            <div class="crop-options">
                                <button id="crop-fill-btn" class="btn">Fill Screen</button>
                                <button id="set-center-btn" class="btn">Center</button>
                                <button id="set-center-h-btn" class="btn">Center H</button>
                                <button id="set-center-v-btn" class="btn">Center V</button>
                                <button id="reset-crop-btn" class="btn">Reset</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="crop-cancel-btn" class="btn">Cancel</button>
                <button id="crop-apply-btn" class="btn">Apply</button>
            </div>
        </div>
    </div>
    
    <button id="reset-display" class="btn floating-btn">Reset Display to Screensaver</button>
    <div class="container">
        <h1 id="page-title">DM Screen Admin</h1>
        
        <div class="section">
            <h2>Upload Images</h2>
            <form id="upload-form" novalidate>
                <div class="form-group">
                    <label for="image-files">Select Images:</label>
                    <input type="file" id="image-files" name="files[]" accept="image/*" multiple>
                </div>
                <div class="form-group">
                    <label for="folder-select">Upload to Folder:</label>
                    <div class="folder-select-container">
                        <select id="folder-select" name="folder">
                            <option value="">/</option>
                            <!-- Folders will be added here dynamically -->
                        </select>
                    </div>
                </div>
                <div id="image-preview-container" style="display: none;">
                    <h3>Preview and Edit Names</h3>
                    <p>You can edit the names and remove images before uploading.</p>
                    <table id="image-preview-table" class="image-preview-table">
                        <thead>
                            <tr>
                                <th>Preview</th>
                                <th>Name</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="image-preview-list">
                            <!-- Images will be added here dynamically -->
                        </tbody>
                    </table>
                </div>
                <button type="submit" class="btn" id="upload-button" disabled>Upload Selected Images</button>
            </form>
        </div>
        
        <div class="section">
            <h2>Image Gallery</h2>
            <div class="folder-navigation">
                <div class="folder-path" id="folder-path">
                    <span class="folder-path-item" data-folder-id="">/</span>
                </div>
                <div class="folder-actions">
                    <button id="new-folder-btn" class="btn">New Folder</button>
                </div>
            </div>
            <div id="gallery" class="gallery"></div>
        </div>
        
        <div class="section">
            <h2>Current Display Preview</h2>
            <div class="preview-container">
                <div id="preview-area">
                    <canvas id="preview-canvas" width="400" height="225"></canvas>
                </div>
                <div class="preview-controls">
                    <p id="preview-status">No image is currently displayed.</p>
                </div>
            </div>
        </div>
        
        <div class="section">
            <h2>Settings</h2>
            <div class="form-group">
                <label for="admin-title">Admin Title:</label>
                <div style="display:flex; gap:8px; align-items:center;">
                    <input type="text" id="admin-title" placeholder="DM Screen Admin" style="max-width: 360px;">
                    <button id="save-admin-title" class="btn">Save</button>
                </div>
                <small>The title shown in the browser tab and as the page heading.</small>
            </div>
            <div class="form-group">
                <label for="primary-color">Primary Color:</label>
                <div style="display:flex; gap:8px; align-items:center;">
                    <input type="color" id="primary-color" value="#6a64ff" style="width: 80px; height: 40px; cursor: pointer;">
                    <button id="save-primary-color" class="btn">Apply Color</button>
                </div>
                <small>Choose a primary color for buttons and accents. Color variations will be calculated automatically.</small>
            </div>
            <div class="form-group">
                <label>Screensaver Image:</label>
                <div class="screensaver-preview">
                    <div id="screensaver-preview-container">
                        <p id="screensaver-preview-text">No screensaver selected</p>
                        <img id="screensaver-preview-img" style="display: none; max-width: 200px; max-height: 120px;">
                    </div>
                    <div class="screensaver-controls">
                        <button id="remove-screensaver" class="btn mt-1">Remove Screensaver</button>
                    </div>
                </div>
                <!-- Hidden select for compatibility with existing code -->
                <select id="screensaver" style="display: none;">
                    <option value="">None</option>
                </select>
            </div>
            <div class="form-group">
                <label>Thumbnail Management:</label>
                <button id="regenerate-thumbnails-btn" class="btn">Regenerate All Thumbnails</button>
                <small>Clear the cache and regenerate thumbnails for all images. This may take a few moments.</small>
            </div>
        </div>
        
        <div class="section">
            <h2>WiFi Configuration</h2>
            <div id="wifi-status">Checking WiFi status...</div>
            <button id="wifi-disconnect-btn" class="btn" style="display: none; margin-top: 8px;">Disconnect</button>
            <form id="wifi-form">
                <div class="form-group">
                    <label for="wifi-ssid">SSID:</label>
                    <div style="display:flex; gap:8px; align-items:center;">
                        <input type="text" id="wifi-ssid" name="ssid" placeholder="Network name" list="wifi-ssid-list">
                        <datalist id="wifi-ssid-list"></datalist>
                    </div>
                </div>
                <div class="form-group">
                    <label for="wifi-password">Password:</label>
                    <input type="password" id="wifi-password" name="password" placeholder="Network password">
                </div>
                <button type="submit" class="btn">Configure WiFi</button>
            </form>
            <div class="form-group" style="margin-top:16px;">
                <h3>Known WiFi Networks</h3>
                <small>Remove saved credentials if a wrong password was entered.</small>
                <div style="margin-top:8px;">
                    <button id="wifi-known-refresh" class="btn">Refresh List</button>
                </div>
                <ul id="known-wifi-list" style="margin-top:8px; padding-left:16px;"></ul>
            </div>
        </div>
    </div>

    <script src="js/webpjs.js"></script>
    <script src="js/admin.js"></script>